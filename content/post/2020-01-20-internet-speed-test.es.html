---
title: Monitoreando su velocidad real de Internet a lo largo del tiempo, utilizando R y Speedtest-CLI
description: Aprenda a usar la Interfaz de Línea de Comandos Speedtest de Ookla para obtener medidas recurrentes de su velocidad de Internet, almacenar los resultados y hacer gráficos de los datos, todo esto utilizando R.
author: andres-castro
date: '2020-01-21'
slug: speed_test
categories:
  - R
series: 
  - DIY
tags:
  - cron
  - ggplot2
  - odbc
  - speedtest
  - ookla
  - raspberry-pi
draft: true
images: ["speed_test.jpg"]
authors: ["andres-castro"]
output:
  blogdown::html_page:
    toc: true
    highlight: zenburn
---

<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#preparando-su-configuración">Preparando su Configuración</a></li>
<li><a href="#reuniendo-dato">Reuniendo Dato</a></li>
<li><a href="#visualizando-los-datos">Visualizando los Datos</a></li>
</ul>
</div>

<p>Pensé que esto solo sucedía en mi país (Perú), pero resulta que les sucede a personas en todo el mundo, uno contrata un plan de Internet que ofrece <strong>hasta</strong> <code>X</code> Mbps, donde <code>X</code> es un valor impresionante (relativo al contexto de cada país), pero la trampa está en esa palabra, <strong>Hasta</strong>.</p>
{{% tweet "1217915622023147542" %}}
<p>En realidad, termina obteniendo velocidades de descarga mucho más lentas de lo anunciado, y los ISP (Proveedores de Servicios de Internet por sus siglas en inglés) se salen con la suya, ya que solo prueban la velocidad de descarga con usted, una vez, cuando instalan el servicio (sospechosamente funciona muy bien en ese momento) y la mayoría de personas no se molestan en realizar un seguimiento de sus velocidades de descarga a lo largo del tiempo, ya que no es práctico realizar pruebas de velocidad manualmente cada corto período de tiempo, afortunadamente hay una mejor manera, el servicio <a href="https://www.speedtest.net/">Speedtest de Ookla</a> provee una <em><strong>Interfaz de Línea de Comandos (CLI por sus siglas en inglés)</strong></em>, que le permite realizar pruebas desde la terminal de su sistema, dándole la capacidad de configurar scripts automáticos para recopilar datos de rendimiento de la conexión.</p>
<p>En las siguientes líneas, le mostraré cómo hacer esto desde R y obtener los resultados en forma de bonitos gráficos que puede twittear a su ISP para molestarlos un poco. :satisfied:</p>
<div id="preparando-su-configuración" class="section level2">
<h2>Preparando su Configuración</h2>
<p>Tenemos que configurar nuestro entorno de trabajo para este proyecto. Primero, necesitamos una máquina que esté constantemente encendida y conectada a la misma conexión de Internet que desea probar, para que pueda realizar las pruebas y almacenar los datos, podría ser cualquier computadora conectada a su red local pero la solución más práctica (y económica) que he encontrado es usando una Raspberry Pi, así que usaré una para este proyecto.</p>
<p>Dado que está leyendo un artículo relacionado con R, voy a suponer que ya tiene su entorno de R básico configurado, por lo que nos centraremos en las cosas adicionales, necesitamos instalar la interfaz de línea de comandos (CLI) de Speedtest, si está en una máquina Linux, puede hacerlo con estos comandos en una terminal del sistema:</p>
<blockquote>
<p>:pencil2: Hay <a href="https://www.speedtest.net/apps/cli">instrucciones de instalación para otros sistemas operativos</a> en el sitio web de Speedtest.</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="fu">sudo</span> apt-get install gnupg1 apt-transport-https dirmngr</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="bu">export</span> <span class="va">INSTALL_KEY=</span>379CE192D401AB61</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># Versiones de Ubuntu soportadas: xenial, bionic</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># Versiones de Debian soportadas: jessie, stretch, buster</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="bu">export</span> <span class="va">DEB_DISTRO=$(</span><span class="ex">lsb_release</span> -sc<span class="va">)</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="fu">sudo</span> apt-key adv --keyserver keyserver.ubuntu.com --recv-keys <span class="va">$INSTALL_KEY</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="bu">echo</span> <span class="st">&quot;deb https://ookla.bintray.com/debian </span><span class="va">${DEB_DISTRO}</span><span class="st"> main&quot;</span> <span class="kw">|</span> <span class="fu">sudo</span> tee  /etc/apt/sources.list.d/speedtest.list</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="fu">sudo</span> apt-get update</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="fu">sudo</span> apt-get install speedtest</a></code></pre></div>
<blockquote>
<p>:pencil2: Compruebe si tiene instalada una versión anterior Python de la CLI en su sistema y asegúrese de desinstalarla con este comando <code>sudo pip uninstall speedtes-cli</code>, ya que podría causar conflictos con la versión oficial más reciente. Esto me sucedió y no me di cuenta :flushed:, gracias a <a href="https://twitter.com/jasongrahn">@jasongrahn</a> por el aviso.</p>
</blockquote>
</div>
<div id="reuniendo-dato" class="section level2">
<h2>Reuniendo Dato</h2>
<p>Ahora podemos escribir un script R que recupere el resultado de la prueba, procese el contenido y almacene los datos. En este ejemplo, los voy a almacenar en una base de datos PostgreSQL, pero podría elegir otras opciones como otro servidor SQL, Hojas de cálculo de Google, un archivo CSV, etc. He llamado a este script <code>speedtest_job.R</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#! /usr/bin/env Rscript</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># Adquisición de datos</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">output &lt;-<span class="st"> </span><span class="kw">read.csv</span>(</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">text =</span> <span class="kw">system</span>(</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    <span class="dt">command =</span> <span class="st">&quot;speedtest -f csv --output-header --accept-license&quot;</span>,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    <span class="dt">intern =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  <span class="dt">time =</span> <span class="kw">as.POSIXct</span>(<span class="kw">Sys.time</span>()),</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">  <span class="dt">ip =</span> <span class="kw">system</span>(<span class="st">&quot;curl ifconfig.me&quot;</span>, <span class="dt">intern =</span> <span class="ot">TRUE</span>), <span class="co"># Este campo ya no se provee en la nueva versión de la CLI.</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">  <span class="dt">ping =</span> output<span class="op">$</span>latency,</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">  <span class="dt">download =</span> output<span class="op">$</span>download <span class="op">*</span><span class="st"> </span><span class="fl">7.629395E-6</span>, <span class="co"># Convertir a Mbps</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17">  <span class="dt">upload =</span> output<span class="op">$</span>upload <span class="op">*</span><span class="st"> </span><span class="fl">7.629395E-6</span>, <span class="co"># Convertir a Mbps</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">  <span class="dt">isp =</span> <span class="st">&quot;movistar&quot;</span> <span class="co"># Este campo no se provee en formato CSV.</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19">)</a>
<a class="sourceLine" id="cb2-20" data-line-number="20"></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co"># Almacenamiento de datos</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22">connection_string &lt;-<span class="st"> </span>glue<span class="op">::</span><span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">  <span class="st">&quot;Driver={{PostgreSQL ANSI}};</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="st">  Uid={Sys.getenv(&#39;MY_UID&#39;)};</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="st">  Pwd={Sys.getenv(&#39;MY_PWD&#39;)};</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="st">  Server=localhost;</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="st">  Port=5432;</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="st">  Database=internet;&quot;</span> <span class="co"># Nombre de la base de datos en el servidor SQL</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29">) </a>
<a class="sourceLine" id="cb2-30" data-line-number="30"></a>
<a class="sourceLine" id="cb2-31" data-line-number="31">con &lt;-<span class="st"> </span>odbc<span class="op">::</span><span class="kw">dbConnect</span>(</a>
<a class="sourceLine" id="cb2-32" data-line-number="32">  <span class="dt">drv =</span> odbc<span class="op">::</span><span class="kw">odbc</span>(),</a>
<a class="sourceLine" id="cb2-33" data-line-number="33">  <span class="dt">.connection_string =</span> connection_string,</a>
<a class="sourceLine" id="cb2-34" data-line-number="34">  <span class="dt">encoding =</span> <span class="st">&quot;utf8&quot;</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35">)</a>
<a class="sourceLine" id="cb2-36" data-line-number="36"></a>
<a class="sourceLine" id="cb2-37" data-line-number="37">DBI<span class="op">::</span><span class="kw">dbAppendTable</span>(</a>
<a class="sourceLine" id="cb2-38" data-line-number="38">  <span class="dt">conn =</span> con,</a>
<a class="sourceLine" id="cb2-39" data-line-number="39">  <span class="dt">name =</span> <span class="st">&quot;speed_test&quot;</span>, <span class="co"># Nombre de la tabla en el servidor SQL</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40">  <span class="dt">value =</span> results</a>
<a class="sourceLine" id="cb2-41" data-line-number="41">)</a>
<a class="sourceLine" id="cb2-42" data-line-number="42"></a>
<a class="sourceLine" id="cb2-43" data-line-number="43">odbc<span class="op">::</span><span class="kw">dbDisconnect</span>(<span class="dt">conn =</span> con)</a>
<a class="sourceLine" id="cb2-44" data-line-number="44"></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="co"># Limpiando los archivos de registro</span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46"><span class="kw">unlink</span>(<span class="dt">x =</span> <span class="st">&quot;*.log&quot;</span>, <span class="dt">force =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Ahora podemos programar un trabajo <code>cron</code> para ejecutar este script a intervalos regulares, voy a configurarlo para que se ejecute una vez cada hora ejecutando estos comandos en un terminal del sistema:</p>
<blockquote>
<p>:pencil2: Esto también se puede hacer desde R usando el paquete <code>cronR</code>.</p>
</blockquote>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="fu">env</span> EDITOR=nano crontab -e</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="co"># Agregue esta línea</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="ex">0</span> * * * * /usr/local/lib/R/bin/Rscript <span class="st">&#39;/home/pi/speedtest_job.R&#39;</span> <span class="op">&gt;&gt;</span> <span class="st">&#39;/dev/null&#39;</span> <span class="op">2&gt;&amp;1</span> <span class="co"># Modifique la ruta del archivo según sea necesario. </span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="fu">sudo</span> service cron reload</a></code></pre></div>
<p>Después de dejar pasar un tiempo para que se acumulen los registros, podemos obtener datos del servidor con una consulta SQL:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(odbc)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">connection_string &lt;-<span class="st"> </span>glue<span class="op">::</span><span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="st">&quot;Driver={{PostgreSQL ANSI}};</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  Uid={Sys.getenv(&#39;MY_UID&#39;)};</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">  Pwd={Sys.getenv(&#39;MY_PWD&#39;)};</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  Server={Sys.getenv(&#39;MY_REMOTE&#39;)};</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="st">  Port=5432;</span><span class="ch">\\</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">  Database=internet;&quot;</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">  <span class="dt">drv =</span> odbc<span class="op">::</span><span class="kw">odbc</span>(),</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">  <span class="dt">.connection_string =</span> connection_string,</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">  <span class="dt">encoding =</span> <span class="st">&quot;utf8&quot;</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17">)</a>
<a class="sourceLine" id="cb4-18" data-line-number="18"></a>
<a class="sourceLine" id="cb4-19" data-line-number="19">query &lt;-<span class="st"> &quot;</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="st">SELECT * </span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="st">FROM public.speed_test </span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="st">ORDER BY time</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"></a>
<a class="sourceLine" id="cb4-25" data-line-number="25">raw_data &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">  <span class="dt">conn =</span> con,</a>
<a class="sourceLine" id="cb4-27" data-line-number="27">  <span class="dt">statement =</span> query</a>
<a class="sourceLine" id="cb4-28" data-line-number="28">)</a>
<a class="sourceLine" id="cb4-29" data-line-number="29"></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="kw">dbDisconnect</span>(con)</a></code></pre></div>
</div>
<div id="visualizando-los-datos" class="section level2">
<h2>Visualizando los Datos</h2>
<p>Ahora que tenemos algunos datos para trabajar, podemos comenzar a hacer algunos gráficos. Dado que este no es un artículo sobre <code>ggplopt2</code>, no voy a entrar en detalles sobre esta parte, solo voy a mostrar algunos gráficos interesantes que puede obtener sobre la velocidad de su conexión a Internet.</p>
<p>En la Figura <a href="#fig:histogram">1</a> podemos ver cómo se distribuyen las velocidades de descarga observadas, dejando de lado el hecho de que la velocidad anunciada ya es lenta (para los estándares de los países desarrollados), esto revela un patrón que es muy común, la mayoría de las veces usted obtiene velocidades de descarga que son mucho más lentas de lo anunciado por el ISP e incluso tan lentas que no cumplen con los términos de su contrato, como en mi caso (en realidad usé esta imagen para presentar una queja).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">library</span>(xkcd)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">library</span>(tibbletime)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co"># Estas son mis configuraciones de tema personales, puede ignorarlas si lo prefiere</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="kw">theme_set</span>(</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  <span class="kw">theme_gray</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="st">    </span><span class="kw">theme_xkcd</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>,</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">          <span class="dt">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>,</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">          <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">margin =</span> <span class="kw">margin</span>(<span class="dt">t =</span> <span class="dv">10</span>)),</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">          <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">margin =</span> <span class="kw">margin</span>(<span class="dt">r =</span> <span class="dv">10</span>)),</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">          <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">20</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">          <span class="dt">plot.margin =</span> <span class="kw">margin</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">          <span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Cloud Calligraphy&quot;</span>))</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">)</a>
<a class="sourceLine" id="cb5-19" data-line-number="19"></a>
<a class="sourceLine" id="cb5-20" data-line-number="20">color &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Moda&quot;</span> =<span class="st"> &quot;#008B00&quot;</span>, <span class="st">&quot;Parámetros&quot;</span> =<span class="st"> &quot;orange&quot;</span>)</a>
<a class="sourceLine" id="cb5-21" data-line-number="21"></a>
<a class="sourceLine" id="cb5-22" data-line-number="22">raw_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> download)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>, <span class="dt">fill =</span> <span class="st">&quot;#00B2EE&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">20</span>, <span class="dt">color =</span> <span class="st">&quot;Parámetros&quot;</span>),  <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">8</span>, <span class="dt">color =</span> <span class="st">&quot;Parámetros&quot;</span>),  <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="st">  </span><span class="kw">stat_bin</span>(<span class="dt">geom =</span> <span class="st">&quot;vline&quot;</span>,</a>
<a class="sourceLine" id="cb5-28" data-line-number="28">           <span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="kw">stat</span>(<span class="kw">ifelse</span>(count <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(count), x, <span class="ot">NA</span>)),</a>
<a class="sourceLine" id="cb5-29" data-line-number="29">               <span class="dt">color =</span> <span class="st">&quot;Moda&quot;</span>),</a>
<a class="sourceLine" id="cb5-30" data-line-number="30">           <span class="dt">binwidth =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb5-32" data-line-number="32">           <span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">8.4</span>, <span class="fl">20.4</span>),</a>
<a class="sourceLine" id="cb5-33" data-line-number="33">           <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">8</span>),</a>
<a class="sourceLine" id="cb5-34" data-line-number="34">           <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;Velocidad Mínima Garantizada&quot;</span>, <span class="st">&quot;Velocidad Ofrecida&quot;</span>),</a>
<a class="sourceLine" id="cb5-35" data-line-number="35">           <span class="dt">family =</span> <span class="st">&quot;Cloud Calligraphy&quot;</span>,</a>
<a class="sourceLine" id="cb5-36" data-line-number="36">           <span class="dt">size =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb5-37" data-line-number="37">           <span class="dt">angle =</span> <span class="dv">90</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-38" data-line-number="38"><span class="st">  </span><span class="kw">stat_bin</span>(<span class="dt">geom =</span> <span class="st">&quot;label&quot;</span>,</a>
<a class="sourceLine" id="cb5-39" data-line-number="39">           <span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">stat</span>(<span class="kw">ifelse</span>(count <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(count), <span class="kw">round</span>(x, <span class="dv">1</span>), <span class="ot">NA</span>))),</a>
<a class="sourceLine" id="cb5-40" data-line-number="40">           <span class="dt">binwidth =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb5-41" data-line-number="41">           <span class="dt">family =</span> <span class="st">&quot;xkcd&quot;</span>,</a>
<a class="sourceLine" id="cb5-42" data-line-number="42">           <span class="dt">color =</span> <span class="st">&quot;#008B00&quot;</span>,</a>
<a class="sourceLine" id="cb5-43" data-line-number="43">           <span class="dt">vjust =</span> <span class="fl">-0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-44" data-line-number="44"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;HISTOGRAMA DE VELOCIDADES DE DESCARGA OBSERVADAS&#39;</span>,</a>
<a class="sourceLine" id="cb5-45" data-line-number="45">       <span class="dt">subtitle =</span><span class="st">&#39;ISP: MOVISTAR 20 Mbps&#39;</span>, </a>
<a class="sourceLine" id="cb5-46" data-line-number="46">       <span class="dt">x =</span> <span class="st">&#39;Velocidad (Mbps)&#39;</span>,</a>
<a class="sourceLine" id="cb5-47" data-line-number="47">       <span class="dt">y =</span> <span class="st">&#39;Frecuencia&#39;</span>,</a>
<a class="sourceLine" id="cb5-48" data-line-number="48">       <span class="dt">colour =</span> <span class="st">&#39;&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-49" data-line-number="49"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">22</span>, <span class="dt">by =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb5-50" data-line-number="50">                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">23</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-51" data-line-number="51"><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> color) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-52" data-line-number="52"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">clip =</span> <span class="st">&#39;off&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-53" data-line-number="53"><span class="st">  </span><span class="ot">NULL</span></a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:histogram"></span>
<img src="/post/2020-01-20-internet-speed-test.es_files/figure-html/histogram-1.png" alt="Histograma de Velocidades de Descarga Observadas" width="768" />
<p class="caption">
Figure 1: Histograma de Velocidades de Descarga Observadas
</p>
</div>
<p>Con las Figuras <a href="#fig:line">2</a> y <a href="#fig:box">3</a>, podemos mostrar con qué frecuencia las velocidades de descarga caen por debajo de la velocidad mínima garantizada.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Velocidad Promedio&quot;</span> =<span class="st"> &quot;blue&quot;</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">            <span class="st">&quot;Parámetros&quot;</span> =<span class="st"> &quot;orange&quot;</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">            <span class="st">&quot;Falla&quot;</span> =<span class="st"> &quot;red&quot;</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">            <span class="st">&quot;Velocidad de Descarga&quot;</span> =<span class="st"> &quot;#00B2EE&quot;</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">plot_data &lt;-<span class="st"> </span>raw_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="st">  </span><span class="kw">as_tbl_time</span>(<span class="dt">index =</span> time) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">  </span><span class="kw">collapse_by</span>(<span class="st">&#39;1 hour&#39;</span>, <span class="dt">side =</span> <span class="st">&#39;start&#39;</span>, <span class="dt">clean =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">mean_speed &lt;-<span class="st"> </span>plot_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">  </span><span class="kw">pull</span>(download) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="st">  </span><span class="kw">mean</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="st">  </span><span class="kw">round</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-15" data-line-number="15"></a>
<a class="sourceLine" id="cb6-16" data-line-number="16">plot_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> download)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Velocidad de Descarga&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> plot_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(download <span class="op">&lt;</span><span class="st"> </span><span class="dv">8</span>),</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">             <span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;Falla&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> plot_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(download <span class="op">&lt;</span><span class="st"> </span><span class="dv">8</span>),</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">             <span class="dt">shape =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">             <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>,</a>
<a class="sourceLine" id="cb6-24" data-line-number="24">             <span class="dt">size =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">20</span>, <span class="dt">color =</span> <span class="st">&quot;Parámetros&quot;</span>),  <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">8</span>, <span class="dt">color =</span> <span class="st">&quot;Parámetros&quot;</span>),  <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> mean_speed, <span class="dt">color =</span> <span class="st">&quot;Velocidad Promedio&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">           <span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="kw">c</span>(<span class="st">&quot;2019-06-24 11:00:00 UTC&quot;</span>, <span class="st">&quot;2019-06-24 11:00:00 UTC&quot;</span>)),</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">           <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">19</span>),</a>
<a class="sourceLine" id="cb6-31" data-line-number="31">           <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;Velocidad Mínima Garantizada&quot;</span>, <span class="st">&quot;Velocidad Ofrecida&quot;</span>),</a>
<a class="sourceLine" id="cb6-32" data-line-number="32">           <span class="dt">family =</span> <span class="st">&quot;Cloud Calligraphy&quot;</span>,</a>
<a class="sourceLine" id="cb6-33" data-line-number="33">           <span class="dt">size=</span><span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="st">  </span><span class="kw">geom_label</span>(<span class="dt">x =</span> <span class="kw">as.POSIXct</span>(<span class="st">&quot;2019-08-01 11:00:00 UTC&quot;</span>),</a>
<a class="sourceLine" id="cb6-35" data-line-number="35">             <span class="dt">y =</span> mean_speed,</a>
<a class="sourceLine" id="cb6-36" data-line-number="36">             <span class="dt">label =</span> mean_speed,</a>
<a class="sourceLine" id="cb6-37" data-line-number="37">             <span class="dt">family =</span> <span class="st">&quot;xkcd&quot;</span>,</a>
<a class="sourceLine" id="cb6-38" data-line-number="38">             <span class="dt">show.legend =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb6-39" data-line-number="39">             <span class="dt">inherit.aes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb6-40" data-line-number="40">             <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)  <span class="op">+</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;VELOCIDADES DE DESCARGA OBSERVADAS&#39;</span>,</a>
<a class="sourceLine" id="cb6-42" data-line-number="42">       <span class="dt">subtitle =</span><span class="st">&#39;ISP: MOVISTAR 20 Mbps&#39;</span>, </a>
<a class="sourceLine" id="cb6-43" data-line-number="43">       <span class="dt">x =</span> <span class="st">&#39;Fecha&#39;</span>,</a>
<a class="sourceLine" id="cb6-44" data-line-number="44">       <span class="dt">y =</span> <span class="st">&#39;Velocidad (Mbps)&#39;</span>,</a>
<a class="sourceLine" id="cb6-45" data-line-number="45">       <span class="dt">color =</span> <span class="st">&#39;Leyenda:&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-46" data-line-number="46"><span class="st">  </span><span class="kw">scale_x_datetime</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;5 days&quot;</span>,</a>
<a class="sourceLine" id="cb6-47" data-line-number="47">                   <span class="dt">labels =</span> <span class="kw">label_date_short</span>(), </a>
<a class="sourceLine" id="cb6-48" data-line-number="48">                   <span class="dt">expand =</span> <span class="kw">expansion</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.04</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-49" data-line-number="49"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">22</span>, <span class="dt">by =</span> <span class="dv">2</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">23</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-50" data-line-number="50"><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> colors) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-51" data-line-number="51"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">clip =</span> <span class="st">&#39;off&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-52" data-line-number="52"><span class="st">  </span><span class="ot">NULL</span></a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:line"></span>
<img src="/post/2020-01-20-internet-speed-test.es_files/figure-html/line-1.png" alt="Velocidades de Descarga Observadas" width="768" />
<p class="caption">
Figure 2: Velocidades de Descarga Observadas
</p>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">faults &lt;-<span class="st"> </span>plot_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">event_type =</span> <span class="kw">ifelse</span>(download <span class="op">&lt;=</span><span class="st"> </span><span class="dv">8</span>, <span class="st">&#39;fault&#39;</span>, <span class="st">&#39;normal&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(event_type <span class="op">==</span><span class="st"> &#39;fault&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tbf =</span> <span class="kw">as.numeric</span>(<span class="kw">as.period</span>(<span class="kw">interval</span>(<span class="kw">lag</span>(time), time),</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">                                    <span class="dt">unit =</span> <span class="st">&#39;seconds&#39;</span>)) <span class="op">/</span><span class="st"> </span>(<span class="dv">3600</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw">tail</span>(<span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">faults <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&#39;&#39;</span>, <span class="dt">y =</span> tbf)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&#39;#FF303094&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_label</span>(<span class="dt">y =</span> <span class="kw">median</span>(faults<span class="op">$</span>tbf),</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">             <span class="dt">label =</span> <span class="kw">paste</span>(<span class="kw">round</span>(<span class="kw">median</span>(faults<span class="op">$</span>tbf),<span class="dv">1</span>), <span class="st">&#39;h&#39;</span>),</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">             <span class="dt">family =</span> <span class="st">&quot;xkcd&quot;</span>,</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">             <span class="dt">show.legend =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">             <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;DIAGRAMA DE CAJA DE TIEMPO ENTRE FALLAS&#39;</span>,</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">       <span class="dt">subtitle =</span><span class="st">&#39;ISP: MOVISTAR 20 Mbps&#39;</span>,</a>
<a class="sourceLine" id="cb7-19" data-line-number="19">       <span class="dt">x =</span> <span class="st">&#39;&#39;</span>,</a>
<a class="sourceLine" id="cb7-20" data-line-number="20">       <span class="dt">y =</span> <span class="st">&#39;Horas&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="st">  </span><span class="ot">NULL</span></a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:box"></span>
<img src="/post/2020-01-20-internet-speed-test.es_files/figure-html/box-1.png" alt="Diagrama de Caja de Tiempo Entre Fallas" width="672" />
<p class="caption">
Figure 3: Diagrama de Caja de Tiempo Entre Fallas
</p>
</div>
<p>Y con la Figura <a href="#fig:boxes">4</a> podemos saber cuándo ocurren las horas pico, para saber a qué hora del día es más probable que experimentemos velocidades de Internet lentas.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">hour_data &lt;-<span class="st"> </span>plot_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw">collapse_by</span>(<span class="st">&#39;1 hour&#39;</span>, <span class="dt">side =</span> <span class="st">&#39;start&#39;</span>, <span class="dt">clean =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time =</span> <span class="kw">format</span>(time, <span class="st">&quot;%H:%M&quot;</span>))</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">hour_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> download)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">fill =</span> <span class="st">&quot;#00B2EE&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> hour_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(download <span class="op">&lt;</span><span class="st"> </span><span class="dv">8</span>),</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">             <span class="dt">shape =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">             <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>,</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">             <span class="dt">size =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">20</span>), <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>,  <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">8</span>), <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>,  <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb8-15" data-line-number="15">           <span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;04:00&quot;</span>, <span class="st">&quot;04:00&quot;</span>),</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">           <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">19</span>),</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">           <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;Velocidad Mínima Garantizada&quot;</span>, <span class="st">&quot;Velocidad Ofrecida&quot;</span>),</a>
<a class="sourceLine" id="cb8-18" data-line-number="18">           <span class="dt">family =</span> <span class="st">&quot;Cloud Calligraphy&quot;</span>,</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">           <span class="dt">size =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;DIAGRAMA DE CAJA DE VELOCIDADES DES DESCARGA OBSERVADAS</span><span class="ch">\n</span><span class="st">POR HORA DEL DÍA&#39;</span>,</a>
<a class="sourceLine" id="cb8-21" data-line-number="21">       <span class="dt">subtitle =</span><span class="st">&#39;ISP: MOVISTAR 20 Mbps&#39;</span>,</a>
<a class="sourceLine" id="cb8-22" data-line-number="22">       <span class="dt">x =</span> <span class="st">&#39;Hora&#39;</span>,</a>
<a class="sourceLine" id="cb8-23" data-line-number="23">       <span class="dt">y =</span> <span class="st">&#39;Velocidad (Mbps)&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">22</span>, <span class="dt">by =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb8-25" data-line-number="25">                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">22</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">clip =</span> <span class="st">&#39;off&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="st">  </span><span class="ot">NULL</span></a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:boxes"></span>
<img src="/post/2020-01-20-internet-speed-test.es_files/figure-html/boxes-1.png" alt="Diagrama de Caja de Velocidades de Descarga Observadas por Hora del Día" width="768" />
<p class="caption">
Figure 4: Diagrama de Caja de Velocidades de Descarga Observadas por Hora del Día
</p>
</div>
<p>Una vez que tiene datos, las posibilidades de gráficos solo están limitadas por su imaginación, por lo que me detendré aquí, espero que haya disfrutado leyendo este artículo y ahora esté motivado para comenzar a monitorear su propia velocidad de Internet. ¡Que se divierta!, ¡lo veo pronto!.</p>
</div>
